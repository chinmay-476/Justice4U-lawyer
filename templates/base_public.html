<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<meta name="theme-color" content="#007bff">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="apple-mobile-web-app-title" content="LegalMatch">
	<meta name="msapplication-TileColor" content="#007bff">
	
	<title>{% block title %}LegalMatch{% endblock %}</title>
	
	<!-- PWA Manifest -->
	<link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
	
	<!-- Apple Touch Icons -->
	<link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
	<link rel="apple-touch-icon" sizes="152x152" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
	<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
	<link rel="apple-touch-icon" sizes="167x167" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
	
	<!-- Favicon -->
	<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
	<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
	
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
	<style>
		body { background: #f8f9fa; }
		.topbar { background: #0d6efd; }
		.topbar .navbar-brand { font-weight: 700; }
		.main { padding: 0; }
	</style>
	{% block extra_css %}{% endblock %}
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-dark topbar">
		<div class="container-fluid">
			<a class="navbar-brand" href="{{ url_for('home') }}"><i class="bi bi-scales me-2"></i>LegalMatch</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#pubNav">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="pubNav">
				<div class="navbar-nav ms-auto d-flex gap-2">
					<a class="btn btn-outline-light btn-sm" href="{{ url_for('login_user') }}">
						<i class="bi bi-box-arrow-in-right me-1"></i>User Login
					</a>
					<a class="btn btn-outline-light btn-sm" href="{{ url_for('register_user') }}">
						<i class="bi bi-person-add me-1"></i>User Register
					</a>
					<a class="btn btn-outline-light btn-sm" href="{{ url_for('lawyer_login') }}">
						<i class="bi bi-shield-check me-1"></i>Lawyer Portal
					</a>
					<a class="btn btn-outline-light btn-sm" href="{{ url_for('lawyer_registration') }}">
						<i class="bi bi-person-plus me-1"></i>Apply Lawyer
					</a>
					<a class="btn btn-outline-light btn-sm" href="{{ url_for('admin_login') }}">
						<i class="bi bi-gear me-1"></i>Admin
					</a>
				</div>
			</div>
		</div>
	</nav>
	<main class="main">
		{% block content %}{% endblock %}
	</main>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	
	<!-- PWA Service Worker Registration -->
	<script>
		// Register Service Worker
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function() {
				navigator.serviceWorker.register('{{ url_for("static", filename="service-worker.js") }}')
					.then(function(registration) {
						console.log('ServiceWorker registration successful with scope: ', registration.scope);
						
						// Check for updates
						registration.addEventListener('updatefound', function() {
							const newWorker = registration.installing;
							newWorker.addEventListener('statechange', function() {
								if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
									// New content is available, show update notification
									if (confirm('New version available! Reload to update?')) {
										window.location.reload();
									}
								}
							});
						});
					})
					.catch(function(err) {
						console.log('ServiceWorker registration failed: ', err);
					});
			});
		}
		
		// PWA Install Prompt
		let deferredPrompt;
		window.addEventListener('beforeinstallprompt', (e) => {
			e.preventDefault();
			deferredPrompt = e;
			
			// Show install button or notification
			const installButton = document.getElementById('install-button');
			if (installButton) {
				installButton.style.display = 'block';
				installButton.addEventListener('click', async () => {
					if (deferredPrompt) {
						deferredPrompt.prompt();
						const { outcome } = await deferredPrompt.userChoice;
						console.log(`User response to the install prompt: ${outcome}`);
						deferredPrompt = null;
					}
				});
			}
		});
		
		// Track PWA installation
		window.addEventListener('appinstalled', (evt) => {
			console.log('PWA was installed');
			// Hide install button
			const installButton = document.getElementById('install-button');
			if (installButton) {
				installButton.style.display = 'none';
			}
		});
	</script>
	
	{% block extra_js %}{% endblock %}
</body>
</html>
